set $parsed_scheme $https;
if ($http_x_forwarded_proto = "https") {
    set $parsed_scheme on;
}
if ($http_x_forwarded_proto = "http") {
    set $parsed_scheme "";
}

location ~ .php$ {
    fastcgi_pass unix:/run/php-fpm.sock;
    fastcgi_read_timeout 600;
    # Provide as much of Apache's SSL +StdEnvVars data as possible.
    fastcgi_param HTTPS                 $parsed_scheme;
    fastcgi_param SSL_PROTOCOL          $ssl_protocol;
    fastcgi_param SSL_CIPHER            $ssl_cipher;
    fastcgi_param SSL_SESSION_ID        $ssl_session_id;
    fastcgi_param SSL_CLIENT_VERIFY     $ssl_client_verify;
    include fastcgi.conf;
}
